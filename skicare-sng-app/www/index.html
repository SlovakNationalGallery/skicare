<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8"/>

<meta name="format-detection" content="telephone=no"/>
<meta id="viewPortId" name="viewport"
      content="user-scalable=no, width=device-width, initial-scale=1"/>

<title>SNG Skicáre</title>

<script src="cordova.js"></script>
<script src="lib/jquery/jquery.js"></script>

<script>

// define global viewer options here
var VIEWER_OPTIONS = {
    documentView : { closeLabel : "Zavrieť"},
    navigationView : {closeLabel : "Naspäť"}

};

function buildViewerOptions()
{
    var options = $.extend({}, VIEWER_OPTIONS);

    if(window["cordova"])
    {
        if (!options.android)
            options.android = {};
    }
    return options;
}

// list files located in www folder here
var files = [
'Alojz_Rigele_1900.pdf',
'Jaroslav_Augusta_1920.pdf',
'Andrej_Dubravsky_2013.pdf',
'Cyprian_Majernik_1932.pdf',
'Dezider_Milly_1960.pdf',
'Ernest_Spitz_1960_2.pdf',
'Ernest_Spitz_1960.pdf',
'Eugen_Nevan_1960.pdf',
'Jan_Novak_1944.pdf',
'Ladislav_Mednyanszky_1910_2.pdf',
'Ladislav_Mednyanszky_1910.pdf',
'Maximilian_Schurmann_1914.pdf'
];



var baseUrl = location.href.replace("/index.html", "");

var defaultStorage = "assets";

var MIME_TYPES = {
    pdf: 'application/pdf',
    docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
};

var entries = {assets: {}, private: {}, shared: {}};


if (typeof String.prototype.contains === 'undefined')
{
    String.prototype.contains = function (str)
    {
        return this.indexOf(str) != -1;
    };
}

if (typeof String.prototype.endsWith === 'undefined')
{
    String.prototype.endsWith = function (str)
    {
        if (!str)
            return false;
        return this.indexOf(str, this.length - str.length) !== -1;
    };
}

if (typeof String.prototype.startsWith === 'undefined')
{
    String.prototype.startsWith = function (str)
    {
        if (!str)
            return false;
        return this.indexOf(str, 0) == 0;
    };
}

function concatPath(base, uri)
{

    var result = base;
    if (result && !result.endsWith("/"))
        result = result + "/";
    if (uri && uri.startsWith("/"))
        uri = uri.substring(1);
    return result + uri;
}

function getPrivateAppDataRootDirEntry(success, error)
{
    if (!window["cordova"])
    {
        success(null);
        return;
    }

    var path = cordova.file.dataDirectory;
    window.resolveLocalFileSystemURL(
            path,
            function (dir)
            {
                window.console.log(
                        "returning "
                                + path
                                + " / "
                                + dir.nativeURL
                                + " / "
                                + dir.toURL()
                                + " as private data dir");
                success(dir);
            },
            error
    );
}

function getSharedAppDataRootDirEntry(success, error)
{
    if (!window["cordova"])
    {
        success(null);
        return;
    }

    var path = cordova.file.documentsDirectory; // iOS
    if (!path)
        path = cordova.file.externalDataDirectory; // Android

    window.resolveLocalFileSystemURL(
            path,
            function (dir)
            {
                window.console.log(
                        "returning "
                                + path
                                + " / "
                                + dir.nativeURL
                                + " / "
                                + dir.toURL()
                                + " as shared data dir");
                success(dir);
            },
            error
    );
}

function errorHandler(e)
{
    alert("error");
    throw e;
}

function copyFiles(success, error)
{
    function copyFile(entries, dir, file, success)
    {
        var ft = new FileTransfer();

        var dest = concatPath(dir.toURL(), file);

        var source = buildAssetsUrl(file);

        window.console.log("copying " + source + " to " + dest);

        ft.download(
                source,
                dest,
                function (entry)
                {
                    var storageEntry = {url: entry.nativeURL, mimeType: getMimeType(file), entry: entry};
                    setViewerSupport(storageEntry, function ()
                    {
                        entries[file] = storageEntry;
                        success();
                    });
                },
                error
        );

    }

    function copyFiles(entries, dir, success)
    {

        function doIt(idx)
        {
            if (idx >= files.length)
            {
                success();
                return;
            }

            copyFile(entries, dir, files[idx], function ()
            {
                doIt(++idx);
            });
        }

        doIt(0);
    }

    function setViewerSupport(entry, next)
    {
        if (!window['SitewaertsDocumentViewer'])
        {
            entry.canView = null;
            next();
            return;
        }

        var options = buildViewerOptions();

        SitewaertsDocumentViewer.canViewDocument(
                entry.url,
                entry.mimeType,
                options,
                function onPossible()
                {
                    entry.canView = true;
                    next();
                },
                function onMissingApp()
                {
                    entry.canView = true;
                    next();
                },
                function onImpossible()
                {
                    entry.canView = false;
                    next();
                },
                function onError(error)
                {
                    window.console.log(error);
                    entry.canView = false;
                    next();
                }
        );
    }

    function buildAssetEntries(success)
    {
        var myEntries = entries.assets;

        function doIt(idx)
        {
            if (idx >= files.length)
            {
                success();
                return;
            }

            var file = files[idx];
            var entry = {url: buildAssetsUrl(file), mimeType: getMimeType(file)};

            setViewerSupport(entry, function ()
            {
                myEntries[file] = entry;
                doIt(++idx);
            });
        }

        doIt(0);
    }


    // function buildOtherEntries(success)
    // {
    //     getPrivateAppDataRootDirEntry(
    //             function (dir)
    //             {
    //                 if (!dir)
    //                 {
    //                     window.console.log("no private directory available");
    //                     defaultStorage = "assets";
    //                     success();
    //                     return;
    //                 }

    //                 copyFiles(entries.private, dir, function ()
    //                 {
    //                     getSharedAppDataRootDirEntry(
    //                             function (dir)
    //                             {
    //                                 if (!dir)
    //                                 {
    //                                     window.console.log("no shared directory available");
    //                                     defaultStorage = "private";
    //                                     success();
    //                                     return;
    //                                 }
    //                                 copyFiles(entries.shared, dir, success);
    //                             },
    //                             error
    //                     );
    //                 });
    //             },
    //             error
    //     );
    // }
    // buildAssetEntries(function ()
    // {
    //     buildOtherEntries(success)
    // });
    buildAssetEntries(true);

}

function buildUrl(storage, file)
{
    if (file.indexOf('://') > 1)
        return file;

    var url = buildDataUrl(storage, file);
    if (url)
        return url;

    return buildAssetsUrl(file);
}

function buildDataUrl(storage, file)
{
    storage = storage || defaultStorage;
    var entry = entries[storage][file];
    if (entry)
        return entry.url;
    return null;
}

function buildAssetsUrl(file)
{
    return baseUrl + "/" + file;
}

function getMimeType(file)
{
    var suffix = file.split('.').pop();
    return MIME_TYPES[suffix];
}

function createDocumentOpener(file, storage)
{
    return function ()
    {
        window.console.log('otvaram file: ' + file + '; storage: ' + storage);
        return openDocument(file, storage)
    };
}

function openDocument(file, storage)
{
    var url = buildUrl(storage, file);
    var mimeType = entries[storage][file].mimeType;
    viewDocument(url, mimeType, storage);
}

function clickUri(uri)
{
    viewDocument(uri, getMimeType(uri), 'click');
}

function viewDocument(url, mimeType, storage)
{
    if (!window['SitewaertsDocumentViewer'])
    {
        window.console.log("Attempting to view '" + url + "'");
        window.open(url);
        return false;
    }

    // alert("Attempting to view '" + url + "'");

    var options = buildViewerOptions();
    options.title = url.split('/').pop() + '@' + storage;

    SitewaertsDocumentViewer.viewDocument(
            url,
            mimeType,
            options,
            function ()
            {
                // shown
                window.console.log('document shown');
            },
            function ()
            {
                // closed
                window.console.log('document closed');
            },
            function (appId, installer)
            {
                // missing app
                if (confirm("Do you want to install the free PDF Viewer App "
                        + appId + " for Android?"))
                {
                    installer(
                            function ()
                            {
                                window.console.log('successfully installed app');
                                if (confirm("App installed. Do you want to view the document now?"))
                                    viewDocument(url, mimeType, storage);
                            },
                            function (error)
                            {
                                window.console.log('cannot install app');
                                window.console.log(error);
                            }
                    );
                }
            },
            function (error)
            {
                alert('cannot view document ' + url);
                window.console.log('cannot view document ' + url);
                window.console.log(error);
            }

    );
    return false;
}

function buildFileListing()
{
    var $listing = $('#listing');

    for (var fileLocation in entries)
    {
        if (!entries.hasOwnProperty(fileLocation))
            continue;

        var empty = true;
        var $ul = $('<ul></ul>');

        for (var i = 0; i < files.length; i++)
        {
            var file = files[i];
            var entry = entries[fileLocation][file];
            if (!entry)
                continue;

            empty = false;
            var $li = $('<li></li>');
            $ul.append($li);
            var $a = $('<a>' + file + '</a>');
            $a.attr('href', '#');
            $a.attr('title', entry.url);
            window.console.log('file: ' + file);
            window.console.log('fileLocation: ' + fileLocation);
            if (entry.canView == null || entry.canView == true)
            {
                $a.click(createDocumentOpener(file, fileLocation));
            }
            else
            {
                $a.click(function ()
                {
                    alert("Cannot open Document in viewer");
                    return false;
                });
                $a.addClass('disabled');
            }
            $li.append($a);
        }
        if (!empty)
        {
            $listing.append('<h2>' + fileLocation + '</h2>');
            $listing.append($ul);
        }
    }
}

function showSupportInfo(){

    if (!window['SitewaertsDocumentViewer'])
    {
        return;
    }

    var $container = $('#info');

    function appendDeviceInfo(){

        var device = window["device"];
        if(!device)
            return;

        var $info = $('<div></div>');
        var $pre = $('<pre></pre>');
        $pre.html(JSON.stringify(device));
        $info.append('<h2>Device</h2>');
        $info.append($pre);
        $container.append($info);

    }

    SitewaertsDocumentViewer.getSupportInfo(
            function(supportInfo){
                var $info = $('<div></div>');
                var $pre = $('<pre></pre>');
                $pre.html(JSON.stringify(supportInfo));
                $info.append('<h2>Plugin Support</h2>');
                $info.append($pre);
                $container.append($info);
            },
            function(e){
               alert(e);
            }
    );

    appendDeviceInfo();

}

function init()
{
    // copyFiles(
    //         function ()
    //         {
    //             buildFileListing();
    //             $('body').addClass('initialized');
    //         },
    //         errorHandler
    // );
    copyFiles(true, errorHandler);
                $('body').addClass('initialized');
    // showSupportInfo();
}

function assertCordova(){

    if(!window["cordova"])
        alert("Cordova not loaded");
    else if (!window.cordova["file"])
        alert("cordova.file not found. May be you are using the wrong plugin version?");
}

var cordovaPresent = false;

document.addEventListener('deviceready', function ()
{
    cordovaPresent = true;
    $('body').removeClass('initialized');

    assertCordova();

    // wait for debugger
    alert("Click OK to init App");
    $(document).ready(function ()
    {
        init();
    });
});


// setup for desktop browser
setTimeout(function(){

    if(cordovaPresent == true)
        return;

    $(document).ready(function ()
    {
        init();
    });
}, 3000);


</script>


<style type="text/css">
body {margin: 0 !important; padding: 0 !important; font-family: sans-serif;}
a, a:hover, a:visited {
    color: #000;
    text-decoration: none;
}

  .img-responsive {
    display: block;
    max-width: 100%;
    height: auto;
  }

   #skicare {
    display: -webkit-box;
    display: -webkit-flex;
    display: flex;
      align-items: center;
      /*justify-content: center;*/
      flex-direction: row;
      flex-wrap: nowrap;
      justify-content: flex-start;
      height:90%;
             position:absolute;
             top: -0px;
             width:100%;
             padding: 20px;
  }
  #skicare .skicar {
      /*max-width: 50%;*/
      display: block;
      /*border: 1px solid red;*/
      margin: auto 10px;
      /*flex:1;*/
       -webkit-flex: none;
      flex:none;
  }
  #skicare .skicar img {
    /*max-height: 300px;*/
  }
  .big {
    font-size: 36px;
  }
  .big, .title { margin-left: 2px;}



    .ready {
        display: none;
    }

    body.initialized .ready {
        display: block;
    }

    body.initialized .loading {
        display: none;
    }

 </style>




</head>
<body>

<div class="loading">
    Loading ...
</div>

<div class="ready">

<div id="skicare">
    <a class="skicar" href="#" onclick="openDocument('Eugen_Nevan_1960.pdf', 'assets')" style="height: 86.6889632107%; width: auto;">
    <span class="big">#1</span><br>
    <img src="./assets/SVK_SNG.K_5827.jpeg" class="img-responsive" style="height: 96.3210702341%; width: auto;">
        <span class="title">Eugen Nevan / 1960</span>
    </a>

    <a class="skicar" href="#" onclick="openDocument('Jaroslav_Augusta_1920.pdf', 'assets')" style="height: 57.7926421405%; width: auto;">
    <span class="big">#2</span><br>
    <img src="./assets/SVK_SNG.K_1031.jpeg" class="img-responsive" style="height: 64.2140468227%; width: auto;">
        <span class="title">Jaroslav Augusta / 1920</span>
    </a>

    <a class="skicar" href="#" onclick="openDocument('Ladislav_Mednyanszky_1910.pdf', 'assets')" style="height: 40.635451505%; width: auto;">
    <span class="big">#3</span><br>
    <img src="./assets/SVK_SNG.K_12096.jpeg" class="img-responsive" style="height: 45.1505016722%; width: auto;">
        <span class="title">Ladislav Mednyánszky / 1910</span>
    </a>

    <a class="skicar" href="#" onclick="openDocument('Ladislav_Mednyanszky_1910_2.pdf', 'assets')" style="height: 44.8494983278%; width: auto;">
    <span class="big">#4</span><br>
    <img src="./assets/SVK_SNG.K_12084.jpeg" class="img-responsive" style="height: 49.8327759197%; width: auto;">
        <span class="title">Ladislav Mednyánszky / 1910</span>
    </a>

    <a class="skicar" href="#" onclick="openDocument('Alojz_Rigele_1900.pdf', 'assets')" style="height: 40.635451505%; width: auto;">
    <span class="big">#5</span><br>
    <img src="./assets/SVK_SNG.K_6937.jpeg" class="img-responsive" style="height: 45.1505016722%; width: auto;">
        <span class="title">Alojz Rigele / 1900</span>
    </a>

    <a class="skicar" href="#" onclick="openDocument('Andrej_Dubravsky_2013.pdf', 'assets')" style="height: 86.6889632107%; width: auto;">
    <span class="big">#6</span><br>
    <img src="./assets/SVK_SNG.K_18690.jpeg" class="img-responsive" style="height: 96.3210702341%; width: auto;">
        <span class="title">Andrej Dúbravský / 2013</span>
    </a>

    <a class="skicar" href="#" onclick="openDocument('Dezider_Milly_1960.pdf', 'assets')" style="height: 90%; width: auto;">
    <span class="big">#7</span><br>
    <img src="./assets/SVK_SNG.K_7610.jpeg" class="img-responsive" style="height: 100%; width: auto;">
        <span class="title">Dezider Milly / 1960</span>
    </a>

    <a class="skicar" href="#" onclick="openDocument('Maximilian_Schurmann_1914.pdf', 'assets')" style="height: 64.1137123746%; width: auto;">
    <span class="big">#8</span><br>
    <img src="./assets/SVK_SNG.K_13768_-_K_13798.jpeg" class="img-responsive" style="height: 71.237458194%; width: auto;">
        <span class="title">Maximilián Schurmann / 1914</span>
    </a>

    <a class="skicar" href="#" onclick="openDocument('Ernest_Spitz_1960.pdf', 'assets')" style="height: 67.1237458194%; width: auto;">
    <span class="big">#9</span><br>
    <img src="./assets/SVK_SNG.K_5924.jpeg" class="img-responsive" style="height: 74.5819397993%; width: auto;">
        <span class="title">Ernest Špitz / 1960</span>
    </a>

    <a class="skicar" href="#" onclick="openDocument('Ernest_Spitz_1960_2.pdf', 'assets')" style="height: 63.2107023411%; width: auto;">
    <span class="big">#10</span><br>
    <img src="./assets/SVK_SNG.K_5734.jpeg" class="img-responsive" style="height: 70.2341137124%; width: auto;">
        <span class="title">Ernest Špitz / 1960</span>
    </a>

    <a class="skicar" href="#" onclick="openDocument('Jan_Novak_1944.pdf', 'assets')" style="height: 59.8996655518%; width: auto;">
    <span class="big">#13</span><br>
    <img src="./assets/SVK_SNG.K_2012.jpeg" class="img-responsive" style="height: 66.5551839465%; width: auto;">
        <span class="title">Ján Novák / 1944</span>
    </a>

</div>

    <div id="listing" style="display:none"></div>
    <!-- /*<div id="skicare"><a href="#" onclick="openDocument('Alojz_Rigele_1900.pdf', 'assets')">Alojz_Rigele_1900</a></div>*/ -->
    <!-- <div id="skicare"><a href="#" onclick="SitewaertsDocumentViewer.viewDocument(('/Alojz_Rigele_1900.pdf', 'application/pdf')">Alojz_Rigele_1900</a></div> -->

    <div id="anticipated_errors" style="display:none">
        <h2>Invalid file uri</h2>
        <ul>
            <li><a href="#" onclick="clickUri('../missing/notfound.pdf'); return false;">../missing/notfound.pdf</a></li>
        </ul>
    </div>

    <div id="info" style="display:none">


    </div>

</div>


</body>
</html>